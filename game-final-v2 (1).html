<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¸¸æˆå¤§å‚æ¨¡æ‹Ÿå™¨</title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body { 
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
    background: #f8fafc; 
    color: #0f172a; 
    line-height: 1.5; 
    overflow-x: hidden; 
}

/* å¼€å§‹å±å¹• */
.start-screen { 
    display: flex;
    align-items: center; 
    justify-content: center; 
    min-height: 100vh;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
    padding: 1rem;
}
.start-box { 
    background: white; 
    padding: 1.5rem; 
    border-radius: 20px; 
    max-width: 500px; 
    width: 100%; 
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    max-height: 90vh;
    overflow-y: auto;
}
.title { 
    font-size: 2rem; 
    font-weight: 900; 
    background: linear-gradient(135deg, #2563eb, #7c3aed); 
    -webkit-background-clip: text; 
    -webkit-text-fill-color: transparent; 
    margin-bottom: 0.5rem; 
    text-align: center; 
}
.subtitle { 
    color: #64748b; 
    text-align: center; 
    margin-bottom: 1rem; 
    font-size: 0.9rem; 
}

/* æ¸¸æˆè¯´æ˜ */
.rules {
    background: #f8fafc;
    border-radius: 12px;
    padding: 1rem;
    margin-bottom: 1rem;
    font-size: 0.85rem;
    line-height: 1.8;
}
.rules h3 {
    color: #2563eb;
    font-size: 0.95rem;
    margin: 0.8rem 0 0.5rem;
}
.rules h3:first-child {
    margin-top: 0;
}
.rules ul {
    padding-left: 1.2rem;
    margin: 0.3rem 0;
}
.rules li {
    margin: 0.2rem 0;
    color: #64748b;
}
.rules .highlight {
    color: #dc2626;
    font-weight: 700;
}
.rules .success {
    color: #16a34a;
    font-weight: 700;
}

.btn { 
    width: 100%; 
    padding: 1rem; 
    font-size: 1rem; 
    font-weight: 700; 
    border: none; 
    border-radius: 12px; 
    cursor: pointer; 
    margin-bottom: 0.8rem; 
}
.btn-primary { 
    background: linear-gradient(135deg, #2563eb, #7c3aed); 
    color: white; 
}

/* æ¸¸æˆå±å¹• */
.game-screen { 
    display: none; 
    padding-bottom: 70px; 
}
.game-screen.active { 
    display: block; 
}

/* é¡¶éƒ¨æ  */
.top-bar { 
    position: sticky; 
    top: 0; 
    background: white; 
    border-bottom: 1px solid #e2e8f0; 
    padding: 0.6rem 1rem; 
    z-index: 100; 
    box-shadow: 0 2px 8px rgba(0,0,0,0.05); 
}
.top-row { 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    margin-bottom: 0.4rem; 
}
.career-level { 
    font-size: 1rem; 
    font-weight: 900; 
    background: linear-gradient(135deg, #f59e0b, #db2777); 
    -webkit-background-clip: text; 
    -webkit-text-fill-color: transparent; 
}
.career-title { 
    font-size: 0.7rem; 
    color: #64748b; 
}
.quarter { 
    font-size: 1.2rem; 
    font-weight: 900; 
    color: #f59e0b; 
    line-height: 1; 
}
.year { 
    font-size: 0.65rem; 
    color: #64748b; 
}
.stats-mini { 
    display: grid; 
    grid-template-columns: repeat(4, 1fr); 
    gap: 0.4rem; 
    font-size: 0.65rem; 
}
.stat-mini { 
    text-align: center; 
}
.stat-mini-val { 
    font-weight: 700; 
    display: block; 
    font-size: 0.75rem;
}
.stat-mini-lbl { 
    color: #64748b; 
    font-size: 0.6rem; 
}

/* å†…å®¹åŒº */
.content { 
    padding: 1rem; 
}

/* æ•°å€¼å¡ç‰‡ - åˆ†ç±»æ˜¾ç¤º */
.stats-section {
    margin-bottom: 0.8rem;
}
.stats-compact {
    background: white;
    border-radius: 12px;
    padding: 0.8rem;
    margin-bottom: 0.6rem;
    box-shadow: 0 1px 3px rgba(0,0,0,0.08);
}
.stats-title {
    font-size: 0.9rem;
    font-weight: 700;
    margin-bottom: 0.6rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
}
.team-title {
    color: #dc2626;
}
.product-title {
    color: #16a34a;
}
.stats-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.5rem;
}
.stat-item {
    padding: 0.4rem;
    background: #f8fafc;
    border-radius: 6px;
}
.stat-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.3rem;
}
.stat-label {
    font-size: 0.75rem;
    color: #64748b;
}
.stat-value {
    font-weight: 700;
    font-size: 0.85rem;
}
.stat-max {
    font-size: 0.7rem;
    color: #94a3b8;
}
.stat-bar {
    height: 4px;
    background: #e2e8f0;
    border-radius: 2px;
    overflow: hidden;
}
.stat-fill {
    height: 100%;
    transition: width 0.5s;
}

/* ç»­å‘½æœºåˆ¶æŒ‰é’® */
.survival-btn {
    background: linear-gradient(135deg, #f59e0b, #dc2626);
    color: white;
    padding: 0.6rem;
    border-radius: 8px;
    border: none;
    font-size: 0.75rem;
    font-weight: 700;
    cursor: pointer;
    box-shadow: 0 2px 4px rgba(220,38,38,0.2);
}
.survival-btn:active {
    transform: scale(0.95);
}

/* ç»­å‘½é€‰é¡¹ */
.survival-card {
    background: white;
    border-radius: 12px;
    padding: 1rem;
    margin-bottom: 1rem;
    box-shadow: 0 1px 3px rgba(0,0,0,0.08);
}
.survival-title {
    font-size: 1.1rem;
    font-weight: 700;
    color: #dc2626;
    margin-bottom: 0.8rem;
    text-align: center;
}
.survival-desc {
    font-size: 0.85rem;
    color: #64748b;
    text-align: center;
    margin-bottom: 1rem;
    line-height: 1.6;
}
.survival-option {
    background: linear-gradient(135deg, rgba(220,38,38,0.05), rgba(245,158,11,0.05));
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    padding: 0.8rem;
    margin-bottom: 0.6rem;
    cursor: pointer;
}
.survival-option:active {
    border-color: #dc2626;
    transform: scale(0.98);
}
.survival-option-title {
    font-weight: 700;
    color: #dc2626;
    margin-bottom: 0.3rem;
    font-size: 0.95rem;
}
.survival-option-desc {
    font-size: 0.8rem;
    color: #64748b;
    margin-bottom: 0.5rem;
}

/* å†³ç­–å¡ç‰‡ */
.card { 
    background: white; 
    border-radius: 12px; 
    padding: 1rem; 
    margin-bottom: 1rem; 
    box-shadow: 0 1px 3px rgba(0,0,0,0.08); 
}
.card h3 { 
    margin-bottom: 0.8rem; 
    font-size: 1.05rem;
    color: #2563eb;
}
.choice { 
    background: #f8fafc; 
    border: 2px solid #e2e8f0; 
    border-radius: 10px; 
    padding: 0.8rem; 
    margin-bottom: 0.6rem; 
    cursor: pointer; 
}
.choice:active {
    border-color: #2563eb;
    transform: scale(0.98);
}
.choice-label { 
    font-weight: 700; 
    color: #2563eb; 
    margin-bottom: 0.3rem; 
    font-size: 0.95rem;
}
.choice-desc { 
    font-size: 0.8rem; 
    color: #64748b; 
    margin-bottom: 0.6rem; 
    line-height: 1.5;
}
.choice-effects { 
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
}
.effects-row {
    display: flex;
    flex-wrap: wrap;
    gap: 0.3rem;
    align-items: center;
}
.effects-label {
    font-size: 0.7rem;
    color: #64748b;
    font-weight: 600;
    margin-right: 0.3rem;
}
.effect-tag { 
    padding: 0.2rem 0.4rem; 
    border-radius: 4px; 
    font-size: 0.65rem; 
    font-weight: 600; 
}
.effect-positive { 
    background: rgba(22,163,74,0.15); 
    color: #16a34a; 
}
.effect-negative { 
    background: rgba(220,38,38,0.15); 
    color: #dc2626; 
}

/* å¯¹è¯æµ®å±‚ */
.dialog-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.6);
    z-index: 200;
    align-items: flex-end;
    justify-content: center;
}
.dialog-overlay.active {
    display: flex;
}
.dialog-box {
    background: white;
    width: 100%;
    max-width: 500px;
    border-radius: 20px 20px 0 0;
    max-height: 75vh;
    overflow-y: auto;
    animation: slideUp 0.3s ease-out;
}
@keyframes slideUp {
    from { transform: translateY(100%); }
    to { transform: translateY(0); }
}
.dialog-header {
    padding: 1rem;
    border-bottom: 1px solid #e2e8f0;
    display: flex;
    align-items: center;
}
.avatar {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: linear-gradient(135deg, #2563eb, #7c3aed);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    margin-right: 0.8rem;
    flex-shrink: 0;
}
.speaker-info {
    flex: 1;
}
.speaker-name {
    font-weight: 700;
    font-size: 1rem;
}
.speaker-title {
    font-size: 0.75rem;
    color: #64748b;
}
.dialog-content {
    padding: 1rem;
}
.dialog-text {
    background: #f8fafc;
    padding: 1rem;
    border-radius: 12px;
    margin-bottom: 1rem;
    line-height: 1.7;
    font-size: 0.9rem;
}
.dialog-choices {
    padding: 0 1rem 1rem;
}

/* åº•éƒ¨å¯¼èˆª */
.bottom-nav { 
    position: fixed; 
    bottom: 0; 
    left: 0; 
    right: 0; 
    background: white; 
    border-top: 1px solid #e2e8f0; 
    display: flex; 
    z-index: 100; 
    box-shadow: 0 -2px 10px rgba(0,0,0,0.05); 
}
.nav-item { 
    flex: 1; 
    padding: 0.7rem 0.5rem; 
    text-align: center; 
    border: none; 
    background: none; 
    color: #64748b; 
    cursor: pointer; 
    font-size: 0.7rem; 
}
.nav-item.active { 
    color: #2563eb; 
    background: rgba(37,99,235,0.05); 
}
.nav-icon { 
    font-size: 1.2rem; 
    display: block; 
    margin-bottom: 0.2rem; 
}

/* é¡¹ç›®å‘½å */
.naming-box { 
    background: white; 
    border-radius: 12px; 
    padding: 1.2rem; 
    margin-bottom: 1rem; 
    box-shadow: 0 1px 3px rgba(0,0,0,0.08);
}
.naming-title { 
    font-size: 1.1rem; 
    font-weight: 700; 
    margin-bottom: 0.8rem; 
    text-align: center;
    color: #2563eb;
}
.name-input { 
    width: 100%; 
    padding: 0.8rem; 
    border: 2px solid #e2e8f0; 
    border-radius: 10px; 
    font-size: 1rem; 
    margin-bottom: 0.6rem; 
}
.btn-secondary {
    background: #f8fafc;
    color: #0f172a;
    border: 2px solid #e2e8f0;
}

/* å¹´åº¦æ€»ç»“ */
.year-end { 
    background: white; 
    border-radius: 16px; 
    padding: 1.5rem; 
    margin-bottom: 1rem;
    text-align: center; 
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}
.year-end-title { 
    font-size: 1.3rem; 
    font-weight: 700; 
    margin-bottom: 0.5rem; 
}
.year-end-metrics { 
    display: grid; 
    grid-template-columns: repeat(2, 1fr); 
    gap: 0.8rem; 
    margin: 1rem 0; 
}
.year-metric { 
    background: #f8fafc; 
    padding: 0.8rem; 
    border-radius: 10px; 
}
.year-metric-val { 
    font-size: 1.3rem; 
    font-weight: 900; 
    background: linear-gradient(135deg, #2563eb, #7c3aed); 
    -webkit-background-clip: text; 
    -webkit-text-fill-color: transparent; 
}
.year-metric-lbl { 
    font-size: 0.75rem; 
    color: #64748b; 
    margin-bottom: 0.3rem; 
}

/* äº§å“åˆ—è¡¨ */
.product-card {
    background: white;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    padding: 0.8rem;
    margin-bottom: 0.6rem;
}
.product-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.5rem;
}
.product-name {
    font-weight: 700;
    font-size: 0.95rem;
}
.product-status {
    padding: 0.2rem 0.5rem;
    border-radius: 4px;
    font-size: 0.7rem;
    font-weight: 700;
}
.status-live {
    background: rgba(22,163,74,0.1);
    color: #16a34a;
}

/* è¿è¥å†³ç­– */
.op-product-header {
    background: linear-gradient(135deg, rgba(37,99,235,0.1), rgba(124,58,237,0.1));
    border-radius: 10px;
    padding: 0.8rem;
    margin-bottom: 0.8rem;
}
.op-product-name {
    font-size: 1.1rem;
    font-weight: 700;
    margin-bottom: 0.3rem;
}
.op-product-stats {
    font-size: 0.8rem;
    color: #64748b;
}

/* æ»‘å—äº¤æ˜“ç³»ç»Ÿ */
.trade-selector {
    margin: 1rem 0;
}
.selector-row {
    display: flex;
    align-items: center;
    margin-bottom: 0.8rem;
}
.selector-row label {
    min-width: 60px;
    font-weight: 700;
    color: #64748b;
    font-size: 0.85rem;
}
.trade-select {
    flex: 1;
    padding: 0.6rem;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    font-size: 0.9rem;
    background: white;
}
.current-stats {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.6rem;
    margin: 1rem 0;
    padding: 1rem;
    background: linear-gradient(135deg, rgba(37,99,235,0.05), rgba(124,58,237,0.05));
    border-radius: 10px;
}
.stat-display {
    font-size: 0.85rem;
    color: #64748b;
}
.stat-display strong {
    color: #0f172a;
    font-size: 1rem;
}
.stat-emoji {
    font-size: 1.1rem;
}

.hidden { 
    display: none !important; 
}
    </style>
</head>
<body>

<!-- å¼€å§‹å±å¹• -->
<div class="start-screen" id="startScreen">
    <div class="start-box">
        <h1 class="title">æ¸¸æˆå¤§å‚æ¨¡æ‹Ÿå™¨</h1>
        <p class="subtitle">ä»ä¸»ç­–åˆ’åˆ°å·¥ä½œå®¤æ€»è£çš„æ™‹å‡ä¹‹è·¯</p>
        
        <div class="rules">
            <h3>ğŸ® æ¸¸æˆç›®æ ‡</h3>
            <ul>
                <li>ä»L1-1ä¸»ç­–åˆ’å¼€å§‹,é€æ­¥æ™‹å‡åˆ°L4-1å·¥ä½œå®¤æ€»è£</li>
                <li>æ¯å¹´å¼€å‘ä¸€æ¬¾æ–°æ¸¸æˆ,è¿è¥å·²ä¸Šçº¿äº§å“</li>
                <li>è¾¾åˆ°æ”¶å…¥å’Œç”¨æˆ·ç›®æ ‡åå³å¯æ™‹å‡</li>
            </ul>
            
            <h3>ğŸ’€ ç”Ÿæ­»çº¿æœºåˆ¶</h3>
            <ul>
                <li><span class="highlight">ä»»æ„æ•°å€¼å½’é›¶ = æ¸¸æˆç»“æŸ</span></li>
                <li>å›¢é˜Ÿæ•°å€¼:å£«æ°”ã€ä¿¡ä»»ã€ç°é‡‘ã€å‘é‡</li>
                <li>äº§å“æ•°å€¼:æœŸå¾…ã€åˆ›æ–°ã€å¯ç©æ€§ã€å•†ä¸šåŒ–</li>
            </ul>
            
            <h3>âš¡ ç»­å‘½æœºåˆ¶(æ•‘å‘½ç¨»è‰!)</h3>
            <ul>
                <li><span class="success">å±æ€¥æ—¶åˆ»å¯ä»¥ç”¨ä¸€ä¸ªæ•°å€¼æ¢å¦ä¸€ä¸ª</span></li>
                <li>996åŠ ç­:ç”¨å‘é‡æ¢å£«æ°”(è‡ªå·±ä¸Š,å…„å¼Ÿä»¬æ­‡æ­‡)</li>
                <li>å‘ä¸Šç”»é¥¼:ç”¨å£«æ°”æ¢ä¿¡ä»»(è€æ¿ä½ çœ‹æˆ‘å¤šåŠªåŠ›)</li>
                <li>åˆ·è€æ¿å¡:ç”¨ä¿¡ä»»æ¢ç°é‡‘(å†å€Ÿç‚¹é¢„ç®—å§)</li>
                <li>æŠ æŠ æœæœ:ç”¨ç°é‡‘æ¢å‘é‡(çœé’±ä¹°ç”Ÿå‘æ°´)</li>
                <li><span class="highlight">æ¯æ¬¡äº¤æ¢ä¼šæŸå¤±30%!</span></li>
            </ul>
            
            <h3>ğŸ“ˆ æˆé•¿æœºåˆ¶</h3>
            <ul>
                <li>æ¯æˆåŠŸä¸€æ¬¾äº§å“,æ•°å€¼ä¸Šé™æå‡35%</li>
                <li>ä½†å†³ç­–å½±å“ä¹Ÿä¼šå¢å¤§15%</li>
                <li>è¶Šå¾€åè¶Šéš¾,éœ€è¦æ›´è°¨æ…å†³ç­–</li>
            </ul>
            
            <h3>âš–ï¸ æ ¸å¿ƒç©æ³•</h3>
            <ul>
                <li>æ¯å­£åº¦:çªå‘äº‹ä»¶ â†’ æ–°äº§å“å¼€å‘ â†’ æˆç†Ÿäº§å“è¿è¥</li>
                <li>ç»¿è‰²=åŠ åˆ†,çº¢è‰²=å‡åˆ†,æƒè¡¡åˆ©å¼Š</li>
            </ul>
        </div>
        
        <button class="btn btn-primary" id="startBtn">å¼€å§‹å·äº†</button>
    </div>
</div>

<!-- æ¸¸æˆå±å¹• -->
<div class="game-screen" id="gameScreen">
    <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
    <div class="top-bar">
        <div class="top-row">
            <div>
                <div class="career-level" id="careerLevel">L1-1</div>
                <div class="career-title" id="careerTitle">ä¸»ç­–åˆ’</div>
            </div>
            <div style="text-align: right;">
                <div class="quarter" id="quarter">Q1</div>
                <div class="year">ç¬¬<span id="year">1</span>å¹´</div>
            </div>
        </div>
        <div class="stats-mini">
            <div class="stat-mini">
                <span class="stat-mini-val" id="miniRev">0</span>
                <span class="stat-mini-lbl">æ€»æ”¶å…¥</span>
            </div>
            <div class="stat-mini">
                <span class="stat-mini-val" id="miniUsers">0</span>
                <span class="stat-mini-lbl">æ€»ç”¨æˆ·</span>
            </div>
            <div class="stat-mini">
                <span class="stat-mini-val" id="miniProducts">0</span>
                <span class="stat-mini-lbl">åœ¨çº¿äº§å“</span>
            </div>
            <div class="stat-mini">
                <span class="stat-mini-val" id="miniQRev">0</span>
                <span class="stat-mini-lbl">å­£åº¦æ”¶å…¥</span>
            </div>
        </div>
    </div>

    <!-- å†…å®¹åŒº -->
    <div class="content">
        <div id="mainContent"></div>
    </div>

    <!-- åº•éƒ¨å¯¼èˆª -->
    <div class="bottom-nav">
        <button class="nav-item active" id="navDecision">
            <span class="nav-icon">ğŸ”§</span>
            æ–°äº§å“å¼€å‘
        </button>
        <button class="nav-item" id="navProducts">
            <span class="nav-icon">ğŸ“¦</span>
            æˆç†Ÿäº§å“è¿è¥
        </button>
        <button class="nav-item hidden" id="navOperation">
            <span class="nav-icon">ğŸ“ˆ</span>
            æˆç†Ÿäº§å“è¿è¥
        </button>
    </div>
</div>

<!-- å¯¹è¯æµ®å±‚ -->
<div class="dialog-overlay" id="dialogOverlay">
    <div class="dialog-box">
        <div class="dialog-header">
            <div class="avatar" id="dialogAvatar">ğŸ‘¤</div>
            <div class="speaker-info">
                <div class="speaker-name" id="speakerName">å¼ ä¸‰</div>
                <div class="speaker-title" id="speakerTitle">CEO</div>
            </div>
        </div>
        <div class="dialog-content">
            <div class="dialog-text" id="dialogText"></div>
        </div>
        <div class="dialog-choices" id="dialogChoices"></div>
    </div>
</div>

<script>
// æ¸¸æˆæ•°æ®
var LEVELS = {
    'L1-1': {title:'ä¸»ç­–åˆ’',next:'L1-2',rev:3000,users:150},
    'L1-2': {title:'æ‰§è¡Œåˆ¶ä½œäºº',next:'L2-1',rev:10000,users:500},
    'L2-1': {title:'å‰¯åˆ¶ä½œäºº',next:'L2-2',rev:30000,users:1500}
};

var TYPES = {
    'äºŒæ¬¡å…ƒå¡ç‰Œ':{userMul:1.2,revMul:1.5,life:80,decay:12},
    'MMORPG':{userMul:0.6,revMul:2.5,life:150,decay:6},
    'ä¼‘é—²ä¸‰æ¶ˆ':{userMul:2.0,revMul:0.6,life:60,decay:15}
};

var NAME_PREFIXES = ['æ¢¦å¹»','èµ›åš','æ˜Ÿé™…','æœ«æ—¥','é­”æ³•','æˆ˜å›½','æš—é»‘','åƒç´ ','æ”¾ç½®'];
var NAME_SUFFIXES = ['ä»™ä¾ ','æœ‹å…‹2099','å¾æœ','æ±‚ç”Ÿ','å­¦é™¢','é£äº‘','åœ°ç‰¢','å†’é™©','ä»™é€”'];

// å¯¹è¯äººç‰©
var CHARACTERS = {
    ceo: {name:'ææ€»',title:'CEO / å¤©å¤©æ”¹éœ€æ±‚',avatar:'ğŸ‘”'},
    lead_designer: {name:'ç‹ç­–',title:'ä¸»ç­–åˆ’ / çµé­‚äººç‰©',avatar:'ğŸ¨'},
    lead_dev: {name:'å¼ ç¨‹',title:'ä¸»ç¨‹åº / æŠ€æœ¯å¤§ç‰›',avatar:'ğŸ’»'},
    investor: {name:'æŠ•èµ„æ–¹',title:'è‘£äº‹ / é’±è¢‹å­',avatar:'ğŸ’¼'},
    competitor: {name:'éš”å£è€ç‹',title:'ç«å¯¹åˆ¶ä½œäºº',avatar:'âš”ï¸'},
    media: {name:'æ¸¸æˆåª’ä½“',title:'IGNè®°è€…',avatar:'ğŸ“°'},
    player: {name:'ç©å®¶ä»£è¡¨',title:'æ°ªé‡‘å¤§ä½¬',avatar:'ğŸ®'},
    hr: {name:'HRå°å§å§',title:'äººåŠ›èµ„æº',avatar:'ğŸ‘©'}
};

// ç»­å‘½é€‰é¡¹
// æ»‘å—äº¤æ˜“æ–‡æ¡ˆ - æ‰€æœ‰å¯èƒ½çš„äº¤æ¢ç»„åˆ
var SURVIVAL_EXCHANGE_MAP = {
    'morale_trust': {title:'å‘ä¸Šç”»é¥¼', text:'ç»™è€æ¿ä¸€é¡¿PPT,ç”»é¥¼æ‰“é¸¡è¡€:"ææ€»æ‚¨çœ‹,å’±è¿™é¡¹ç›®ç»å¯¹æ˜¯çˆ†æ¬¾!"'},
    'morale_cash': {title:'å‹æ¦¨å›¢é˜Ÿ', text:'å…¨å‘˜996åŠ ç­èµ¶è¿›åº¦,çœä¸‹å¤–åŒ…è´¹:"å…„å¼Ÿä»¬,è¿™ä¸ªæœˆå…ˆæ¬ ç€,ä¸‹ä¸ªæœˆä¸€èµ·å‘!"'},
    'morale_hair': {title:'å¼ºåˆ¶ä¼‘å‡', text:'å¼ºåˆ¶å›¢é˜Ÿå»ä¼‘å‡ä¿å…»å¤´å‘,ä½†å£«æ°”å—æŒ«:"ä»€ä¹ˆ?ä¸è®¸åŠ ç­?æˆ‘çš„æ™‹å‡æœºä¼šå‘¢?"'},
    'trust_morale': {title:'å‘é’±æ”¶ä¹°', text:'åˆ·è€æ¿ä¿¡ç”¨å¡ç»™å›¢é˜Ÿå‘å¥–é‡‘:"ææ€»è¯´äº†,å¤§å®¶è¾›è‹¦äº†,æ¯äºº5000å—!"'},
    'trust_cash': {title:'å†åˆ·è€æ¿å¡', text:'è¶è€æ¿å¿ƒæƒ…å¥½å¤šæŠ¥é”€ç‚¹:"ææ€»,è¿™ä¸ªæœåŠ¡å™¨çœŸçš„å¾ˆæœ‰å¿…è¦å‡çº§..."'},
    'trust_hair': {title:'ç”³è¯·ä½“æ£€', text:'è¯´æœè€æ¿ç»™å›¢é˜Ÿåšä½“æ£€å’Œç†ç–—:"ææ€»,å’±ä»¬å…³å¿ƒå‘˜å·¥å¥åº·,å£ç¢‘å¥½æ‹›äººå®¹æ˜“!"'},
    'cash_morale': {title:'å›¢å»ºæ‰“é¸¡è¡€', text:'ç»„ç»‡è±ªåå›¢å»º:"å…„å¼Ÿä»¬!æµ·åº•æèµ°èµ·!KTVå”±åˆ°å¤©äº®!"'},
    'cash_trust': {title:'æ•°æ®é€ å‡', text:'èŠ±é’±ä¹°æ¼‚äº®çš„æ•°æ®æŠ¥å‘Šç»™è€æ¿çœ‹:"ææ€»æ‚¨çœ‹,ç•™å­˜ç‡æš´æ¶¨30%!"'},
    'cash_hair': {title:'ä¹°ç”Ÿå‘æ°´', text:'ç»™å…¨å‘˜é…å‘éœ¸ç‹é˜²è„±æ´—å‘æ°´å’Œç”Ÿå‘ç²¾å:"ç”¨äº†éƒ½è¯´å¥½,å¤´å‘å“—å“—é•¿!"'},
    'hair_morale': {title:'äº²è‡ªä¸‹åœº', text:'è‡ªå·±é€šå®µè‚ä»£ç ,è®©å›¢é˜Ÿæ—©ç‚¹ä¸‹ç­:"ä½ ä»¬å…ˆèµ°,è¿™ä¸ªBUGæˆ‘ä»Šæ™šæå®š!"'},
    'hair_trust': {title:'è¯‰è‹¦å–æƒ¨', text:'é¡¶ç€ç§ƒå¤´å»æ‰¾è€æ¿è¯‰è‹¦:"ææ€»æ‚¨çœ‹æˆ‘è¿™å¤´å‘,éƒ½æ˜¯ä¸ºäº†é¡¹ç›®å•Š..."'},
    'hair_cash': {title:'ä»¥èº«ä½œåˆ™', text:'è‡ªå·±åŠ ç­çœå¤–åŒ…è´¹:"æˆ‘è‡ªå·±æå®š,ä¸ç”¨èŠ±é’±æ‰¾å¤–åŒ…äº†!"'}
};

var SURVIVAL_OPTIONS = [
    {
        title: '996åŠ ç­ç»­å‘½',
        desc: 'è‡ªå·±ä¸Šæ‰‹åš,å…„å¼Ÿä»¬å…ˆæ­‡æ­‡å§',
        emoji: 'ğŸ’ª',
        from: 'hair',
        to: 'morale',
        fromLabel: 'å‘é‡',
        toLabel: 'å£«æ°”',
        amount: 30,
        loss: 0.3
    },
    {
        title: 'å‘ä¸Šç”»é¥¼ç®¡ç†',
        desc: 'è·Ÿè€æ¿æ±‡æŠ¥ä¸‹æˆæœ,åˆ·åˆ·ä¿¡ä»»åº¦',
        emoji: 'ğŸ¨',
        from: 'morale',
        to: 'trust',
        fromLabel: 'å£«æ°”',
        toLabel: 'ä¿¡ä»»',
        amount: 30,
        loss: 0.3
    },
    {
        title: 'å†åˆ·è€æ¿ä¿¡ç”¨å¡',
        desc: 'è€æ¿æˆ‘ä»¬éœ€è¦è¿½åŠ é¢„ç®—...',
        emoji: 'ğŸ’³',
        from: 'trust',
        to: 'cash',
        fromLabel: 'ä¿¡ä»»',
        toLabel: 'ç°é‡‘',
        amount: 30,
        loss: 0.3
    },
    {
        title: 'æŠ æŠ æœæœè¿‡æ—¥å­',
        desc: 'çœé’±ä¹°ç”Ÿå‘æ°´,å…»å…»å¤´å‘',
        emoji: 'ğŸ’°',
        from: 'cash',
        to: 'hair',
        fromLabel: 'ç°é‡‘',
        toLabel: 'å‘é‡',
        amount: 30,
        loss: 0.3
    },
    {
        title: 'æ‰“é¸¡è¡€åŠ¨å‘˜å¤§ä¼š',
        desc: 'ç”»é¥¼é¼“èˆå£«æ°”,ä½†è¦èŠ±é’±å›¢å»º',
        emoji: 'ğŸ“¢',
        from: 'cash',
        to: 'morale',
        fromLabel: 'ç°é‡‘',
        toLabel: 'å£«æ°”',
        amount: 25,
        loss: 0.3
    },
    {
        title: 'è·Ÿè€æ¿è¯‰è¯‰è‹¦',
        desc: 'ç”¨å¤´å‘å’Œæ±—æ°´æ¢è€æ¿ä¿¡ä»»',
        emoji: 'ğŸ˜­',
        from: 'hair',
        to: 'trust',
        fromLabel: 'å‘é‡',
        toLabel: 'ä¿¡ä»»',
        amount: 25,
        loss: 0.3
    }
];

// çªå‘äº‹ä»¶ - ç®€åŒ–ä¸º2ä¸ªæ•°å€¼å˜åŒ–,å¹…åº¦Â±5-8
var EVENTS = [
    {char:'ceo',text:'è€æ¿çªç„¶è¦åŠ æ–°åŠŸèƒ½:"æˆ‘æ˜¨æ™šåˆ·æŠ–éŸ³çœ‹åˆ°ä¸ªæ‘‡ä¸€æ‘‡,å’±ä»¬ä¹ŸåŠ ä¸Š!"',choices:[
        {label:'ç«‹å³åŠ ä¸Š',desc:'è€æ¿è¯´å•¥æ˜¯å•¥',effects:{trust:7,morale:-6}},
        {label:'å©‰è½¬æ‹’ç»',desc:'è®²é“ç†,å¯èƒ½è¢«ç©¿å°é‹',effects:{trust:-7,innovation:5}},
        {label:'åšä¸ªå‡çš„',desc:'å…ˆåº”ä»˜è¿‡å»',effects:{trust:4,playability:-5}}
    ]},
    {char:'lead_designer',text:'ä¸»ç­–åˆ’è¦è·³æ§½:"éš”å£å¤§å‚å¹´è–ªç¿»å€æŒ–æˆ‘,æ˜å¤©å°±èµ°ã€‚"',choices:[
        {label:'åŠ è–ªç•™äºº',desc:'ç ¸é’±ç•™ä¸‹',effects:{morale:6,cash:-8}},
        {label:'æ”¾ä»–èµ°å§',desc:'åŸ¹å…»æ–°äºº',effects:{morale:-7,cash:5}},
        {label:'ç”»é¥¼æŒ½ç•™',desc:'æ‰¿è¯ºæœªæ¥',effects:{morale:()=>Math.random()>0.4?6:-7,cash:3}}
    ]},
    {char:'investor',text:'æŠ•èµ„æ–¹å‚¬ä¿ƒ:"å‹å•†ä¸‹æœˆä¸Šçº¿,æˆ‘ä»¬å¿…é¡»æå‰æŠ¢çª—å£æœŸ!"',choices:[
        {label:'996å†²åˆº',desc:'åŠ ç­èµ¶å·¥',effects:{trust:7,hair:-8}},
        {label:'æ®ç†åŠ›äº‰',desc:'åšæŒè´¨é‡',effects:{trust:-6,playability:6}},
        {label:'ç æ‰åŠŸèƒ½',desc:'é˜‰å‰²ç‰ˆå…ˆä¸Š',effects:{trust:5,playability:-7}}
    ]},
    {char:'competitor',text:'ç«å“æ¶ˆæ¯:"éš”å£å¤§å‚ä¸‹å‘¨ä¸ŠåŒç±»æ¸¸æˆ,è¥é”€é¢„ç®—3ä¸ªäº¿ã€‚"',choices:[
        {label:'è·Ÿä»–ä»¬åˆš',desc:'ä¹°é‡ç¡¬åˆš',effects:{hype:7,cash:-8}},
        {label:'é”™å³°ä¸Šçº¿',desc:'å»¶æœŸé¿å¼€',effects:{hype:-6,playability:6}},
        {label:'ä½›ç³»åº”å¯¹',desc:'è¯¥å’‹å’‹åœ°',effects:{morale:5,hype:-6}}
    ]},
    {char:'media',text:'æ¸¸æˆåª’ä½“å”±è¡°:"è¿™ä¸ªå“ç±»ä»Šå¹´å·²ç»æ­»äº†15æ¬¾äº†ã€‚"',choices:[
        {label:'ç´§æ€¥è½¬å‹',desc:'æ¨å€’é‡æ¥',effects:{innovation:7,morale:-8}},
        {label:'æ­»ç£•åˆ°åº•',desc:'ç›¸ä¿¡è‡ªå·±',effects:{morale:6,hype:-7}},
        {label:'åŠ å¤§è¥é”€',desc:'ç ¸é’±é€ åŠ¿',effects:{hype:7,cash:-8}}
    ]}
];

// å†³ç­–æ•°æ®(ä½¿ç”¨V5çš„Q1-Q4æ•°æ®,æ­¤å¤„çœç•¥å®Œæ•´ä»£ç )
var Q1=[{title:"ç«‹é¡¹ç­”è¾© - ç¡®å®šé¡¹ç›®ç±»å‹",choices:[{label:"äºŒæ¬¡å…ƒå¡ç‰Œ",desc:"è€æ¿æœ€çˆ±,å•†ä¸šåŒ–åƒé€äº†,ä½†åŒè´¨åŒ–ä¸¥é‡å·åˆ°å¤©ä¸Š",effects:{hype:2,monetization:4,trust:2,innovation:-4,hair:-2}},{label:"MMORPG",desc:"æŠ€æœ¯éš¾åº¦æ‹‰æ»¡,æŠ•å…¥å·¨å¤§,å›¢é˜Ÿå¤©å¤©é€šå®µå®¹æ˜“çŒæ­»",effects:{innovation:4,hype:4,cash:-8,morale:-4,hair:-6}},{label:"ä¼‘é—²ä¸‰æ¶ˆ",desc:"åšèµ·æ¥å¿«é¢„ç®—å°‘,ä½†å¤©èŠ±æ¿ä½è€æ¿çœ‹ä¸ä¸Š",effects:{playability:4,morale:2,cash:2,innovation:-6,trust:-4,monetization:-2}}]},{title:"IPæˆæƒ - æ‰¾ä¸ªå¤§è…¿æŠ±",choices:[{label:"ä¹°çƒ­é—¨IP",desc:"ç”²æ–¹çˆ¸çˆ¸è¦ä»·é«˜è¿˜ç®¡å¤´ç®¡è„š,åˆ›æ–°ç©ºé—´ä¸º0",effects:{hype:9,monetization:2,cash:-11,innovation:-9,trust:-4,playability:-2}},{label:"ç”¨ç»å…¸IP",desc:"ä¸‰å›½/è¥¿æ¸¸è€æ‰ç‰™,ä½†ç”¨æˆ·è®¤,åšå‡ºæ¥å°±æ˜¯æ¢çš®",effects:{hype:4,monetization:2,cash:-6,innovation:-6,playability:-2,morale:-2}},{label:"æåŸåˆ›IP",desc:"å‰æœŸæ²¡äººé¸Ÿä½ ,å¼€å‘éš¾åº¦å¤§,ä½†æˆäº†å°±æ˜¯ç‹ç‚¸",effects:{innovation:7,monetization:4,hype:-7,trust:-6,hair:-6,cash:-4}}]},{title:"å›¢é˜Ÿç»„å»º - æ‰¾äººçœŸéš¾",choices:[{label:"æŒ–å¤§å‚æ˜æ˜Ÿ",desc:"èƒ½åŠ›å¼ºç®€å†å¥½çœ‹,ä½†è–ªèµ„é«˜è¿˜ä¸ç¨³å®šå®¹æ˜“è·‘",effects:{innovation:6,playability:4,trust:2,cash:-11,morale:-8,hair:-4}},{label:"æ ¡æ‹›åº”å±Šç”Ÿ",desc:"ä¾¿å®œå¬è¯æœ‰æ¿€æƒ…,ä½†å°±æ˜¯å•¥éƒ½ä¸ä¼šè¯•é”™æˆæœ¬é«˜",effects:{morale:7,cash:4,innovation:2,hair:2,playability:-9,trust:-6}},{label:"å…¨é å¤–åŒ…",desc:"çœé’±çµæ´»,ä½†è´¨é‡åƒå±æ²Ÿé€šå…¨é å¼",effects:{cash:4,monetization:2,playability:-10,trust:-7,innovation:-6,morale:-4}}]},{title:"é¢„ç®—è§„åˆ’ - é’±æ€ä¹ˆèŠ±",choices:[{label:"All inå“è´¨",desc:"é‡é‡‘æŠ•å…¥è¿½æ±‚æè‡´,åæœŸèµ„é‡‘é“¾æ–­è£‚ç©å®Œ",effects:{innovation:4,playability:7,cash:-10,hair:-7,morale:-6,trust:-2}},{label:"æ‰£æ‰£ç´¢ç´¢",desc:"èƒ½çœåˆ™çœç•™åè·¯,äº§å“è´¨é‡ç¨€çƒ‚å£«æ°”ä½è¿·",effects:{cash:8,morale:-7,playability:-9,innovation:-6,hype:-4,trust:-4}}]}];
var Q2=[{title:"ç©æ³•è®¾è®¡ - æ•´ç‚¹èŠ±æ´»",choices:[{label:"åˆ›æ–°èåˆ",desc:"èåˆå¤šä¸ªç©æ³•æåˆ›æ–°,é£é™©å·¨å¤§å®¹æ˜“å››ä¸åƒ",effects:{innovation:11,playability:4,hype:4,hair:-10,morale:-7,trust:-6,cash:-4}},{label:"æŠ„ä½œä¸š",desc:"å€Ÿé‰´æˆç†Ÿç©æ³•æ‰“ç£¨ç»†èŠ‚,ç¨³ä½†è¢«å–·æ¢çš®ç‹—",effects:{playability:9,morale:4,trust:2,innovation:-9,hype:-4,monetization:-4}}]},{title:"ç¾æœ¯é£æ ¼ - è¦ä¸è¦å·ç”»è´¨",choices:[{label:"æ¬¡ä¸–ä»£3D",desc:"ç”»é¢ç‚¸è£‚å¸é‡,ä½†çƒ§é’±çƒ§æ—¶é—´ä¼˜åŒ–åœ°ç‹±",effects:{hype:10,playability:4,innovation:2,cash:-13,hair:-12,morale:-8}},{label:"äºŒæ¬¡å…ƒ",desc:"çº¸ç‰‡äººè€ä¸€å¥—,å•†ä¸šåŒ–æˆç†Ÿä½†åˆ›æ–°ä¸ªé¬¼",effects:{hype:6,monetization:8,cash:-7,innovation:-7,playability:-2}}]},{title:"æŠ€æœ¯é€‰å‹ - ç”¨ä»€ä¹ˆå¼•æ“",choices:[{label:"Unity",desc:"æˆç†Ÿå¥½ç”¨æ–‡æ¡£å…¨,ä½†æˆæƒè´¹è´µå¤§å®¶éƒ½åœ¨ç”¨æ²¡å·®å¼‚åŒ–",effects:{playability:7,morale:4,cash:-7,innovation:-4,hype:-2}},{label:"è‡ªç ”å¼•æ“",desc:"å®Œå…¨è‡ªä¸»æŠ€æœ¯ç§¯ç´¯,ä½†å‘¨æœŸé•¿å‘å¤šäººè·‘å…‰",effects:{innovation:12,trust:4,cash:-11,hair:-16,playability:-11,morale:-11}}]},{title:"æ•°å€¼ä½“ç³» - è®©ç©å®¶æ€ä¹ˆè‚",choices:[{label:"é‡åº¦å…»æˆ",desc:"æ·±åº¦å…»æˆç”Ÿå‘½å‘¨æœŸé•¿,ä½†å‰æœŸåŠé€€æµå¤±é«˜",effects:{playability:7,monetization:9,innovation:2,hype:-7,morale:-4,cash:-2}},{label:"è½»åº¦çˆ½æ¸¸",desc:"çˆ½å¿«å¸é‡æ•°æ®å¥½çœ‹,ä½†å†…å®¹å¿«é€Ÿè€—å°½æš´æ­»",effects:{playability:6,hype:7,morale:4,monetization:-9,innovation:-6,trust:-4}}]}];
var Q3=[{title:"å•†ä¸šåŒ– - æ€ä¹ˆå‰²éŸ­èœ",choices:[{label:"æ°ªé‡‘æ·±åº¦",desc:"é‡åº¦ä»˜è´¹å¸é²¸é±¼,ä½†å£ç¢‘æš´æ­»è¢«éª‚æ­»",effects:{monetization:14,cash:6,hype:-14,trust:-10,morale:-8}},{label:"ä½›ç³»å¾®æ°ª",desc:"è½»åº¦ä»˜è´¹ç©å®¶çˆ½,ä½†æ”¶å…¥æ‹‰èƒ¯è€æ¿éª‚å¨˜",effects:{monetization:4,hype:7,morale:7,trust:4,cash:-6,innovation:-4}}]},{title:"æµ‹è¯•è°ƒä¼˜ - æ•°æ®æš´é›·äº†",choices:[{label:"æ¨ç¿»é‡åš",desc:"æ ¸å¿ƒç©æ³•å…¨æ”¹è´¨é‡æ‹‰æ»¡,å›¢é˜Ÿ996åˆ°å´©æºƒ",effects:{playability:12,innovation:7,hair:-16,morale:-16,cash:-12,trust:-9}},{label:"å°ä¿®å°è¡¥",desc:"æ”¹æ”¹æ•°å€¼é€é€ç¦åˆ©,é—®é¢˜è¿˜åœ¨æ²»æ ‡ä¸æ²»æœ¬",effects:{playability:4,monetization:2,morale:2,innovation:-6,trust:-7,hype:-4}}]},{title:"å†…å®¹å¡«å…… - è¦ä¸è¦åšå‰§æƒ…",choices:[{label:"å‰§æƒ…æ‹‰æ»¡",desc:"å¤§æŠ•å…¥åšå‰§æƒ…æå‡é€¼æ ¼,ä½†æˆæœ¬é«˜å‘¨æœŸé•¿",effects:{playability:7,innovation:6,hype:4,cash:-11,hair:-8,morale:-6}},{label:"ç©æ³•ä¸ºç‹",desc:"åªåšç©æ³•ä¸åšå‰§æƒ…,å¯ç©æ€§å¼ºä½†ç¼ºæ·±åº¦",effects:{playability:10,innovation:7,hair:-11,cash:-9,morale:-7,trust:-2}}]},{title:"æœåŠ¡å™¨ - èƒ½ä¸èƒ½æ’‘ä½",choices:[{label:"è±ªåé…ç½®",desc:"é¡¶é…æœåŠ¡å™¨ä½“éªŒæ‹‰æ»¡,ä½†è¿è¥æˆæœ¬å“æ­»äºº",effects:{playability:10,trust:7,cash:-16,morale:-4}},{label:"çœé’±æ–¹æ¡ˆ",desc:"å¼¹æ€§æ–¹æ¡ˆçœæˆæœ¬,ä½†æŠ€æœ¯å¤æ‚éšæ—¶ç‚¸æœ",effects:{playability:6,innovation:4,cash:-9,hair:-9,trust:-7}}]}];
var Q4=[{title:"è¥é”€ç­–ç•¥ - æ€ä¹ˆè®©äººçŸ¥é“",choices:[{label:"ä¹°é‡ç‹‚é­”",desc:"ç ¸å‡ åƒä¸‡ä¹°é‡å†²æ¦œ,ROIçˆ†ç‚¸å¯èƒ½è¡€äº",effects:{hype:16,cash:-21,trust:-11,morale:-8}},{label:"KOLå¸¦è´§",desc:"æ‰¾UPä¸»å¸¦è´§æå£ç¢‘,èµ·é‡æ…¢å¯èƒ½å‡‰å‡‰",effects:{hype:10,innovation:4,morale:4,cash:-10,trust:-6,playability:-2}}]},{title:"æ¸ é“é€‰æ‹© - æŠ±è°çš„å¤§è…¿",choices:[{label:"å¤§æ¸ é“è”è¿",desc:"ç”¨æˆ·é‡å·¨å¤§è¦†ç›–å…¨,ä½†åˆ†æˆè¦50%è¢«è–…ç¾Šæ¯›",effects:{hype:12,monetization:-12,cash:-8,trust:-8}},{label:"ç‹¬ç«‹å‘è¡Œ",desc:"åˆ†æˆä½è‡ªä¸»æƒå¤§,ä½†æ²¡é‡è¥é”€å…¨é å¼",effects:{monetization:9,innovation:4,morale:4,hype:-6,cash:-6,trust:-7}}]},{title:"ä¸Šçº¿æ—¶æœº - ä»€ä¹ˆæ—¶å€™å¼€æœ",choices:[{label:"æŠ¢è·‘ä¸Šçº¿",desc:"æå‰æŠ¢çª—å£æŠ¢ç”¨æˆ·,ä½†BUGä¸€å †å£ç¢‘å´©",effects:{hype:10,cash:4,playability:-16,trust:-11,hair:-8,morale:-6}},{label:"å»¶æœŸæ‰“ç£¨",desc:"ç»§ç»­ä¼˜åŒ–æå‡å“è´¨,ä½†é”™è¿‡çª—å£æœŸå‡‰å‡‰",effects:{playability:12,innovation:8,hype:-16,cash:-16,hair:-14,trust:-11}}]},{title:"é¦–å‘æ´»åŠ¨ - é€ä¸é€ç¦åˆ©",choices:[{label:"ç¦åˆ©ç‹‚é€",desc:"ç–¯ç‹‚é€èµ„æºç•™ä½ç©å®¶,ä½†åæœŸä»˜è´¹å®Œè›‹",effects:{hype:14,playability:8,morale:8,monetization:-16,cash:-8}},{label:"é¦–å‘ç¤¼åŒ…",desc:"é‡æ°ªç¤¼åŒ…å¿«é€Ÿå›æœ¬,ä½†èˆ†è®ºçˆ†ç‚¸è¢«å–·æ­»",effects:{monetization:16,cash:12,hype:-14,trust:-14,morale:-8}}]}];

// è¿è¥ç­–ç•¥
var OPS = [
    {title:'æ¿€è¿›æ‰©å¼ ',desc:'ç ¸é’±ä¹°é‡åšæ´»åŠ¨å†²KPI,ç”¨æˆ·çˆ†æ¶¨ä½†åŠ é€Ÿè¡°è€å¿«é€Ÿæš´æ­»',effects:{userChange:40,revenueMultiplier:1.35,lifecycleChange:-28,cost:1000}},
    {title:'ç¨³å¥é•¿çº¿',desc:'æŒç»­æ›´æ–°å°æ­¥è¿­ä»£å…»è€ç©å®¶,å¢é•¿æ…¢ä½†æ´»å¾—ä¹…',effects:{userChange:10,revenueMultiplier:1.1,lifecycleChange:15,cost:500}},
    {title:'æä¸€ç¬”å…³æœ',desc:'æœ€åä¸€æ³¢å¼ºæ°ªç¤¼åŒ…æ”¶å‰²é²¸é±¼,èµšå®Œå°±è·‘ç«‹åˆ»æš´æ­»',effects:{userChange:-45,revenueMultiplier:2.5,lifecycleChange:-60,cost:200}},
    {title:'ä½›ç³»ç»´æŠ¤',desc:'æœ€ä½æˆæœ¬æ—¥å¸¸ç»´æŠ¤ä¸æŠ•å…¥,è‡ªç„¶è¡°é€€ç­‰æ­»',effects:{userChange:-18,revenueMultiplier:0.85,lifecycleChange:-22,cost:100}}
];

var g = {
    level:'L1-1',totalRev:0,totalUsers:0,year:1,q:1,actIdx:0,phase:'event',
    products:[],cur:null,morale:90,trust:90,cash:90,hair:90,
    hype:60,innovation:60,playability:60,monetization:60,
    over:false,selType:null,currentNaming:'',inOperation:false,opIdx:0,usedEvents:[],
    successfulProducts:0,statMultiplier:1.0,effectMultiplier:1.0,
    teamMax:100,productMax:100,survivalWarned:false
};

// äº‹ä»¶ç›‘å¬
document.getElementById('startBtn').addEventListener('click', function() {
    newGame();
});

document.getElementById('navDecision').addEventListener('click', function() {
    if(g.inOperation) return;
    showTab('decision');
    // æ¢å¤å½“å‰å†³ç­–ç•Œé¢
    if(g.phase === 'action') {
        showActWithStats();
    } else if(g.phase === 'naming') {
        showNaming();
    }
});

document.getElementById('navProducts').addEventListener('click', function() {
    showTab('products');
});

document.getElementById('navOperation').addEventListener('click', function() {
    if(!g.inOperation) {
        g.inOperation = true;
        g.opIdx = 0;
        showOperation();
    }
    showTab('operation');
});

function newGame() {
    g = {
        level:'L1-1',totalRev:0,totalUsers:0,year:1,q:1,actIdx:0,phase:'naming',
        products:[],cur:null,morale:90,trust:90,cash:90,hair:90,
        hype:60,innovation:60,playability:60,monetization:60,
        over:false,selType:null,currentNaming:'',inOperation:false,opIdx:0,usedEvents:[],
        successfulProducts:0,statMultiplier:1.0,effectMultiplier:1.0,
        teamMax:100,productMax:100,survivalWarned:false
    };
    
    document.getElementById('startScreen').classList.add('hidden');
    document.getElementById('gameScreen').classList.add('active');
    
    updateUI();
    showNaming();
}

function showTab(tab) {
    var navItems = document.querySelectorAll('.nav-item');
    navItems.forEach(function(item) {
        item.classList.remove('active');
    });
    
    if(tab === 'decision') {
        document.getElementById('navDecision').classList.add('active');
    } else if(tab === 'products') {
        document.getElementById('navProducts').classList.add('active');
        showProducts();
    } else if(tab === 'operation') {
        document.getElementById('navOperation').classList.add('active');
    }
}

function showNaming() {
    var html = '<div class="naming-box">';
    html += '<div class="naming-title">ğŸ® æ–°é¡¹ç›®ç«‹é¡¹</div>';
    html += '<input type="text" class="name-input" id="projectName" placeholder="ç»™ä½ çš„æ¸¸æˆèµ·ä¸ªåå­—å§" value="'+g.currentNaming+'">';
    html += '<button class="btn btn-secondary" id="rollBtn">ğŸ² éšæœºç”Ÿæˆ</button>';
    html += '<button class="btn btn-primary" id="confirmBtn">ç¡®è®¤ç«‹é¡¹,å‡†å¤‡ç­”è¾©</button>';
    html += '</div>';
    document.getElementById('mainContent').innerHTML = html;
    
    document.getElementById('rollBtn').addEventListener('click', rollName);
    document.getElementById('confirmBtn').addEventListener('click', confirmName);
}

function rollName() {
    var prefix = NAME_PREFIXES[Math.floor(Math.random()*NAME_PREFIXES.length)];
    var suffix = NAME_SUFFIXES[Math.floor(Math.random()*NAME_SUFFIXES.length)];
    g.currentNaming = prefix + suffix;
    document.getElementById('projectName').value = g.currentNaming;
}

function confirmName() {
    var name = document.getElementById('projectName').value.trim();
    if(!name) { 
        alert('é¡¹ç›®åç§°ä¸èƒ½ä¸ºç©ºå•Šè€é“!'); 
        return; 
    }
    g.cur = {name:name,status:'dev',type:null,baseU:0,curU:0,baseR:0,curR:0,life:100,maxLife:100,decay:10};
    g.selType = null;
    g.phase = 'event';
    g.actIdx = 0;
    nextCard();
}

function nextCard() {
    if(g.over) return;
    if(g.phase === 'event') showEventDialog();
    else if(g.phase === 'action') showActWithStats();
}

// æ˜¾ç¤ºçªå‘äº‹ä»¶å¯¹è¯æ¡†
function showEventDialog() {
    var availEvents = EVENTS.filter(function(e) {
        return g.usedEvents.indexOf(e.text) === -1;
    });
    if(availEvents.length === 0) g.usedEvents = [];
    
    var evt = availEvents[Math.floor(Math.random() * Math.min(availEvents.length, 3))];
    g.usedEvents.push(evt.text);
    
    var char = CHARACTERS[evt.char];
    document.getElementById('dialogAvatar').textContent = char.avatar;
    document.getElementById('speakerName').textContent = char.name;
    document.getElementById('speakerTitle').textContent = char.title;
    document.getElementById('dialogText').textContent = evt.text;
    
    var html = '';
    for(var i=0; i<evt.choices.length; i++) {
        var c = evt.choices[i];
        html += '<div class="choice" data-event-index="'+i+'" data-event-text="'+evt.text.replace(/"/g,'&quot;')+'">';
        html += '<div class="choice-label">'+c.label+'</div>';
        html += '<div class="choice-desc">'+c.desc+'</div>';
        html += '<div class="choice-effects">'+fmtEffSeparate(c.effects)+'</div>';
        html += '</div>';
    }
    document.getElementById('dialogChoices').innerHTML = html;
    
    var choices = document.querySelectorAll('#dialogChoices .choice');
    choices.forEach(function(choice) {
        choice.addEventListener('click', function() {
            var idx = parseInt(this.getAttribute('data-event-index'));
            var text = this.getAttribute('data-event-text');
            handleEvent(idx, text);
        });
    });
    
    document.getElementById('dialogOverlay').classList.add('active');
}

function handleEvent(idx, eventText) {
    var evt = EVENTS.find(function(e) { return e.text === eventText; });
    applyEff(evt.choices[idx].effects);
    
    document.getElementById('dialogOverlay').classList.remove('active');
    g.phase = 'action';
    updateUI();
    setTimeout(function() { nextCard(); }, 300);
}

// å†³ç­–ç•Œé¢åŒæ—¶æ˜¾ç¤ºæ•°å€¼,åˆ†ç±»æ˜¾ç¤ºå›¢é˜Ÿå’Œäº§å“æ•°å€¼
function showActWithStats() {
    var acts = [Q1,Q2,Q3,Q4][g.q-1];
    if(g.actIdx >= acts.length) { 
        nextQ(); 
        return; 
    }
    
    var act = acts[g.actIdx];
    
    // æ•°å€¼å¡ç‰‡ - åˆ†ç±»æ˜¾ç¤º
    var html = '<div class="stats-section">';
    
    // å›¢é˜Ÿæ•°å€¼
    html += '<div class="stats-compact">';
    html += '<div class="stats-title team-title">ğŸ’€ å›¢é˜Ÿç”Ÿæ­»çº¿ <span class="stat-max">(ä¸Šé™:'+g.teamMax+')</span></div>';
    html += '<div class="stats-grid">';
    html += '<div class="stat-item"><div class="stat-header"><span class="stat-label">ğŸ˜Š å£«æ°”</span><span class="stat-value">'+g.morale+'</span></div><div class="stat-bar"><div class="stat-fill" style="width:'+(g.morale/g.teamMax*100)+'%;background:linear-gradient(90deg,#dc2626,#f59e0b)"></div></div></div>';
    html += '<div class="stat-item"><div class="stat-header"><span class="stat-label">ğŸ¤ ä¿¡ä»»</span><span class="stat-value">'+g.trust+'</span></div><div class="stat-bar"><div class="stat-fill" style="width:'+(g.trust/g.teamMax*100)+'%;background:linear-gradient(90deg,#f59e0b,#16a34a)"></div></div></div>';
    html += '<div class="stat-item"><div class="stat-header"><span class="stat-label">ğŸ’µ ç°é‡‘</span><span class="stat-value">'+g.cash+'</span></div><div class="stat-bar"><div class="stat-fill" style="width:'+(g.cash/g.teamMax*100)+'%;background:linear-gradient(90deg,#16a34a,#0891b2)"></div></div></div>';
    html += '<div class="stat-item"><div class="stat-header"><span class="stat-label">ğŸ’ˆ å‘é‡</span><span class="stat-value">'+g.hair+'</span></div><div class="stat-bar"><div class="stat-fill" style="width:'+(g.hair/g.teamMax*100)+'%;background:linear-gradient(90deg,#2563eb,#7c3aed)"></div></div></div>';
    html += '</div>';
    
    // ç»­å‘½æŒ‰é’®
    html += '<div style="margin-top:0.8rem;"><button class="survival-btn" onclick="showSurvivalSlider()">âš¡ æ•°å€¼äº¤æ˜“ç³»ç»Ÿ</button></div>';
    html += '</div>';
    
    // äº§å“æ•°å€¼
    html += '<div class="stats-compact">';
    html += '<div class="stats-title product-title">ğŸ® äº§å“æˆè´¥çº¿ <span class="stat-max">(ä¸Šé™:'+g.productMax+')</span></div>';
    html += '<div class="stats-grid">';
    html += '<div class="stat-item"><div class="stat-header"><span class="stat-label">ğŸ“¢ æœŸå¾…</span><span class="stat-value">'+g.hype+'</span></div><div class="stat-bar"><div class="stat-fill" style="width:'+(g.hype/g.productMax*100)+'%;background:linear-gradient(90deg,#7c3aed,#db2777)"></div></div></div>';
    html += '<div class="stat-item"><div class="stat-header"><span class="stat-label">ğŸ’¡ åˆ›æ–°</span><span class="stat-value">'+g.innovation+'</span></div><div class="stat-bar"><div class="stat-fill" style="width:'+(g.innovation/g.productMax*100)+'%;background:linear-gradient(90deg,#0891b2,#16a34a)"></div></div></div>';
    html += '<div class="stat-item"><div class="stat-header"><span class="stat-label">ğŸ¯ å¯ç©æ€§</span><span class="stat-value">'+g.playability+'</span></div><div class="stat-bar"><div class="stat-fill" style="width:'+(g.playability/g.productMax*100)+'%;background:linear-gradient(90deg,#16a34a,#f59e0b)"></div></div></div>';
    html += '<div class="stat-item"><div class="stat-header"><span class="stat-label">ğŸ’° å•†ä¸šåŒ–</span><span class="stat-value">'+g.monetization+'</span></div><div class="stat-bar"><div class="stat-fill" style="width:'+(g.monetization/g.productMax*100)+'%;background:linear-gradient(90deg,#f59e0b,#dc2626)"></div></div></div>';
    html += '</div></div>';
    
    html += '</div>';
    
    // å†³ç­–å¡ç‰‡
    html += '<div class="card"><h3>'+act.title+'</h3>';
    
    for(var i=0; i<act.choices.length; i++) {
        var c = act.choices[i];
        html += '<div class="choice" data-index="'+i+'">';
        html += '<div class="choice-label">'+c.label+'</div>';
        html += '<div class="choice-desc">'+c.desc+'</div>';
        html += '<div class="choice-effects">'+fmtEffSeparate(c.effects)+'</div>';
        html += '</div>';
    }
    html += '</div>';
    
    document.getElementById('mainContent').innerHTML = html;
    
    var choices = document.querySelectorAll('#mainContent .choice');
    choices.forEach(function(choice) {
        choice.addEventListener('click', function() {
            var idx = parseInt(this.getAttribute('data-index'));
            handleAct(idx);
        });
    });
}

// æ˜¾ç¤ºç»­å‘½é€‰é¡¹
// æ˜¾ç¤ºæ»‘å—äº¤æ˜“ç•Œé¢
function showSurvivalSlider() {
    var html = '<div class="survival-card">';
    html += '<div class="survival-title">âš¡ æ•°å€¼äº¤æ˜“ç³»ç»Ÿ</div>';
    html += '<div class="survival-desc">é€‰æ‹©è¦äº¤æ¢çš„æ•°å€¼,æ‹–åŠ¨æ»‘å—è®¾å®šäº¤æ˜“é‡<br><span style="color:#dc2626;">âš ï¸ äº¤æ˜“ä¼šæŸå¤±30%!</span></div>';
    
    // å½“å‰æ•°å€¼æ˜¾ç¤º
    html += '<div class="current-stats">';
    html += '<div class="stat-display"><span class="stat-emoji">ğŸ˜Š</span> å£«æ°”: <strong>'+g.morale+'</strong></div>';
    html += '<div class="stat-display"><span class="stat-emoji">ğŸ¤</span> ä¿¡ä»»: <strong>'+g.trust+'</strong></div>';
    html += '<div class="stat-display"><span class="stat-emoji">ğŸ’µ</span> ç°é‡‘: <strong>'+g.cash+'</strong></div>';
    html += '<div class="stat-display"><span class="stat-emoji">ğŸ’ˆ</span> å‘é‡: <strong>'+g.hair+'</strong></div>';
    html += '</div>';
    
    // é€‰æ‹©äº¤æ˜“æ•°å€¼
    html += '<div class="trade-selector">';
    html += '<div class="selector-row">';
    html += '<label>ä»˜å‡º:</label>';
    html += '<select id="tradeFrom" class="trade-select">';
    html += '<option value="">é€‰æ‹©æ•°å€¼</option>';
    html += '<option value="morale">ğŸ˜Š å£«æ°” ('+g.morale+')</option>';
    html += '<option value="trust">ğŸ¤ ä¿¡ä»» ('+g.trust+')</option>';
    html += '<option value="cash">ğŸ’µ ç°é‡‘ ('+g.cash+')</option>';
    html += '<option value="hair">ğŸ’ˆ å‘é‡ ('+g.hair+')</option>';
    html += '</select></div>';
    
    html += '<div class="selector-row">';
    html += '<label>è·å¾—:</label>';
    html += '<select id="tradeTo" class="trade-select">';
    html += '<option value="">é€‰æ‹©æ•°å€¼</option>';
    html += '<option value="morale">ğŸ˜Š å£«æ°”</option>';
    html += '<option value="trust">ğŸ¤ ä¿¡ä»»</option>';
    html += '<option value="cash">ğŸ’µ ç°é‡‘</option>';
    html += '<option value="hair">ğŸ’ˆ å‘é‡</option>';
    html += '</select></div>';
    html += '</div>';
    
    // æ»‘å—
    html += '<div id="sliderContainer" class="hidden" style="margin:1rem 0;">';
    html += '<div style="display:flex;justify-content:space-between;margin-bottom:0.5rem;">';
    html += '<span>äº¤æ˜“æ•°é‡:</span><span id="sliderValue" style="font-weight:700;color:#2563eb;">0</span>';
    html += '</div>';
    html += '<input type="range" id="tradeSlider" min="0" max="50" value="0" step="1" style="width:100%;">';
    html += '<div id="tradePreview" style="margin-top:1rem;padding:1rem;background:#f8fafc;border-radius:8px;"></div>';
    html += '</div>';
    
    html += '<div style="margin-top:1rem;">';
    html += '<button class="btn btn-primary" id="confirmTradeBtn" disabled>ç¡®è®¤äº¤æ˜“</button>';
    html += '<button class="btn btn-secondary" onclick="showActWithStats()">è¿”å›</button>';
    html += '</div>';
    html += '</div>';
    
    document.getElementById('mainContent').innerHTML = html;
    
    // ç»‘å®šäº‹ä»¶
    document.getElementById('tradeFrom').addEventListener('change', updateTradePreview);
    document.getElementById('tradeTo').addEventListener('change', updateTradePreview);
    document.getElementById('tradeSlider').addEventListener('input', updateTradePreview);
    document.getElementById('confirmTradeBtn').addEventListener('click', confirmTrade);
}

// æ›´æ–°äº¤æ˜“é¢„è§ˆ
function updateTradePreview() {
    var fromStat = document.getElementById('tradeFrom').value;
    var toStat = document.getElementById('tradeTo').value;
    var amount = parseInt(document.getElementById('tradeSlider').value);
    
    var sliderContainer = document.getElementById('sliderContainer');
    var confirmBtn = document.getElementById('confirmTradeBtn');
    var preview = document.getElementById('tradePreview');
    var sliderValue = document.getElementById('sliderValue');
    
    if(!fromStat || !toStat || fromStat === toStat) {
        sliderContainer.classList.add('hidden');
        confirmBtn.disabled = true;
        return;
    }
    
    sliderContainer.classList.remove('hidden');
    var maxAmount = Math.min(g[fromStat], 50);
    document.getElementById('tradeSlider').max = maxAmount;
    sliderValue.textContent = amount;
    
    if(amount === 0 || amount > g[fromStat]) {
        confirmBtn.disabled = true;
        preview.innerHTML = '<span style="color:#64748b;">è¯·æ‹–åŠ¨æ»‘å—é€‰æ‹©äº¤æ˜“æ•°é‡</span>';
        return;
    }
    
    confirmBtn.disabled = false;
    var gain = Math.round(amount * 0.7);
    var labels = {morale:'å£«æ°”',trust:'ä¿¡ä»»',cash:'ç°é‡‘',hair:'å‘é‡'};
    
    var html = '<div style="text-align:center;">';
    html += '<div style="font-size:1.2rem;margin-bottom:0.5rem;">';
    html += '<span style="color:#dc2626;">-'+amount+'</span> '+labels[fromStat];
    html += ' <span style="color:#64748b;margin:0 0.5rem;">â†’</span> ';
    html += '<span style="color:#16a34a;">+'+gain+'</span> '+labels[toStat];
    html += '</div>';
    html += '<div style="font-size:0.75rem;color:#f59e0b;">âš ï¸ æŸå¤±30% ('+amount+' Ã— 0.7 = '+gain+')</div>';
    html += '</div>';
    
    preview.innerHTML = html;
}

// ç¡®è®¤äº¤æ˜“
function confirmTrade() {
    var fromStat = document.getElementById('tradeFrom').value;
    var toStat = document.getElementById('tradeTo').value;
    var amount = parseInt(document.getElementById('tradeSlider').value);
    
    if(!fromStat || !toStat || amount <= 0 || amount > g[fromStat]) {
        alert('äº¤æ˜“å‚æ•°é”™è¯¯!');
        return;
    }
    
    var gain = Math.round(amount * 0.7);
    g[fromStat] = Math.max(0, g[fromStat] - amount);
    g[toStat] = Math.min(g.teamMax, g[toStat] + gain);
    
    // è·å–æ–‡æ¡ˆ
    var key = fromStat + '_' + toStat;
    var exchange = SURVIVAL_EXCHANGE_MAP[key];
    var title = exchange ? exchange.title : 'æ•°å€¼äº¤æ¢';
    var text = exchange ? exchange.text : 'äº¤æ˜“å®Œæˆ!';
    
    updateUI();
    
    var labels = {morale:'å£«æ°”',trust:'ä¿¡ä»»',cash:'ç°é‡‘',hair:'å‘é‡'};
    var msg = 'âœ… ' + title + '\n\n';
    msg += 'ğŸ’¬ "' + text + '"\n\n';
    msg += 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n';
    msg += 'ğŸ“Š äº¤æ˜“ç»“æœ:\n';
    msg += 'â€¢ ' + labels[fromStat] + ': -' + amount + '\n';
    msg += 'â€¢ ' + labels[toStat] + ': +' + gain + '\n';
    msg += 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”';
    
    alert(msg);
    showActWithStats();
}

// ä¿ç•™æ—§å‡½æ•°ä½œä¸ºå…¼å®¹(ä¸å†ä½¿ç”¨)
function showSurvivalOptions() {
    showSurvivalSlider();
}

function handleSurvival(idx) {
    // å·²åºŸå¼ƒ
}

function handleAct(i) {
    var acts = [Q1,Q2,Q3,Q4][g.q-1];
    var c = acts[g.actIdx].choices[i];
    if(c.type) g.selType = c.type;
    applyEff(c.effects);
    g.actIdx++;
    updateUI();
    setTimeout(function() { nextCard(); }, 200);
}

function nextQ() {
    // è€äº§å“è‡ªç„¶è¡°å‡
    g.products.forEach(function(p) {
        if(p.status === 'live' && p.life > 0) {
            p.life = Math.max(0, p.life - (p.decay || 10));
            p.curU = Math.max(0, Math.round(p.curU * 0.92));
            if(p.life <= 0) p.status = 'dead';
        }
    });
    
    g.q++;
    if(g.q > 4) { 
        finishYr(); 
    } else { 
        g.actIdx = 0; 
        g.phase = 'event';
        updateUI();
        
        // å¦‚æœæœ‰åœ¨çº¿äº§å“ä¸”ä¸åœ¨Q1,è¿›å…¥è¿è¥é˜¶æ®µ
        var liveProds = g.products.filter(function(p) { return p.status === 'live' && p.life > 0; });
        if(liveProds.length > 0 && g.q > 1) {
            g.inOperation = true;
            g.opIdx = 0;
            showOperation();
        } else {
            setTimeout(function() { nextCard(); }, 300);
        }
    }
}

function showOperation() {
    var liveProds = g.products.filter(function(p) { return p.status === 'live' && p.life > 0; });
    
    if(g.opIdx >= liveProds.length) {
        // è¿è¥ç»“æŸ,ç»§ç»­å†³ç­–
        g.inOperation = false;
        updateUI();
        setTimeout(function() { 
            showTab('decision');
            nextCard(); 
        }, 300);
        return;
    }
    
    var prod = liveProds[g.opIdx];
    
    var html = '<div class="op-product-header">';
    html += '<div class="op-product-name">ã€Š'+prod.name+'ã€‹è¿è¥å†³ç­–</div>';
    html += '<div class="op-product-stats">'+prod.type+' | ç”¨æˆ·:'+prod.curU+'ä¸‡ | æœˆæµæ°´:'+prod.curR+'ä¸‡ | ç”Ÿå‘½å‘¨æœŸ:'+prod.life+'%</div>';
    html += '</div>';
    
    html += '<div class="card"><h3>é€‰æ‹©æœ¬å­£åº¦è¿è¥ç­–ç•¥</h3>';
    for(var i=0; i<OPS.length; i++) {
        var s = OPS[i];
        html += '<div class="choice" data-op-index="'+i+'">';
        html += '<div class="choice-label">'+s.title+'</div>';
        html += '<div class="choice-desc">'+s.desc+'</div>';
        html += '<div class="choice-effects">'+fmtOpEff(s.effects)+'</div>';
        html += '</div>';
    }
    html += '</div>';
    
    document.getElementById('mainContent').innerHTML = html;
    
    var choices = document.querySelectorAll('.choice');
    choices.forEach(function(choice) {
        choice.addEventListener('click', function() {
            var idx = parseInt(this.getAttribute('data-op-index'));
            handleOp(idx);
        });
    });
}

function handleOp(i) {
    var liveProds = g.products.filter(function(p) { return p.status === 'live' && p.life > 0; });
    var prod = liveProds[g.opIdx];
    var strategy = OPS[i];
    
    applyOpEff(prod, strategy.effects);
    g.opIdx++;
    updateUI();
    setTimeout(function() { showOperation(); }, 200);
}

function applyOpEff(prod, eff) {
    if(eff.userChange) prod.curU = Math.max(0, prod.curU + eff.userChange);
    if(eff.revenueMultiplier) {
        var arpu = prod.baseU > 0 ? prod.baseR / prod.baseU : 1;
        prod.curR = Math.round(prod.curU * arpu * eff.revenueMultiplier);
    }
    if(eff.lifecycleChange) prod.life = Math.max(0, Math.min(prod.maxLife, prod.life + eff.lifecycleChange));
    if(eff.cost) g.cash = Math.max(0, g.cash - eff.cost / 200);
    
    if(prod.life <= 0) prod.status = 'dead';
}

function finishYr() {
    var typeConf = g.selType ? TYPES[g.selType] : {userMul:1,revMul:1,life:100,decay:10};
    
    // ç”¨æˆ·é‡ = åˆ›æ–°åº¦ + æœŸå¾…å€¼ (ä¸¤è€…å„å 50%)
    var userBase = (g.innovation * 0.5 + g.hype * 0.5);
    var users = Math.round(userBase * 12 * typeConf.userMul);
    
    // æ”¶å…¥ = ç”¨æˆ·é‡ Ã— ARPU,ARPUä¸»è¦å–å†³äºå•†ä¸šåŒ–
    var arpu = Math.round(g.monetization * 0.8 + 10);
    var rev = Math.round(users * arpu / 10 * typeConf.revMul);
    
    // ç”Ÿå‘½å‘¨æœŸä¸»è¦å–å†³äºå¯ç©æ€§
    var lifeFactor = g.playability / 60; // 60åˆ†ä¸ºåŸºå‡†
    var baseLife = Math.round(typeConf.life * lifeFactor);
    
    g.cur.status = 'live';
    g.cur.type = g.selType||'æ¸¸æˆ';
    g.cur.baseU = users;
    g.cur.curU = users;
    g.cur.baseR = rev;
    g.cur.curR = rev;
    g.cur.maxLife = baseLife;
    g.cur.life = baseLife;
    g.cur.decay = typeConf.decay;
    
    g.products.push(g.cur);
    g.totalRev += rev;
    g.totalUsers += users;
    
    // æˆé•¿æœºåˆ¶
    g.successfulProducts++;
    var growthMultiplier = 1 + (g.successfulProducts * 0.35);
    g.teamMax = Math.round(100 * growthMultiplier);
    g.productMax = Math.round(100 * growthMultiplier);
    g.effectMultiplier = 1 + (g.successfulProducts * 0.15);
    
    // è§£é”è¿è¥ç³»ç»Ÿ
    if(g.products.filter(function(p) { return p.status === 'live'; }).length > 0) {
        document.getElementById('navOperation').classList.remove('hidden');
    }
    
    showYrEnd(users, rev);
}

function showYrEnd(u, r) {
    var lvl = LEVELS[g.level];
    var prog = Math.min(100, Math.min((g.totalRev/lvl.rev)*100, (g.totalUsers/lvl.users)*100));
    var desc = 'ã€Š'+g.cur.name+'ã€‹ä¸Šçº¿äº†!é¦–æœˆ'+u+'ä¸‡ç”¨æˆ·,æœˆæµæ°´'+r+'ä¸‡ã€‚';
    
    if(prog >= 100 && lvl.next) {
        g.level = lvl.next;
        desc += '\n\nğŸ‰æ­å–œå‡èŒåŠ è–ª,ç°åœ¨æ˜¯'+LEVELS[g.level].title+'äº†!';
    } else {
        desc += '\n\nç»§ç»­å·å§,ç¦»æ™‹å‡'+lvl.title+'è¿˜å·®ä¸€ç‚¹...';
    }
    
    // æ˜¾ç¤ºæˆé•¿ä¿¡æ¯
    if(g.successfulProducts > 0) {
        desc += '\n\nğŸ“ˆ ä½ å˜å¼ºäº†!æ•°å€¼ä¸Šé™æå‡åˆ°'+g.teamMax+',ä½†å†³ç­–å½±å“ä¹Ÿå¢å¤§äº†'+Math.round(g.effectMultiplier*100-100)+'%!';
    }
    
    var html = '<div class="year-end">';
    html += '<div style="font-size:2.5rem;margin-bottom:1rem;">ğŸ‰</div>';
    html += '<div class="year-end-title">ç¬¬'+g.year+'å¹´å¹´ç»ˆæ€»ç»“</div>';
    html += '<p style="color:#64748b;line-height:1.8;margin:1rem 0;">'+desc.replace(/\n/g,'<br>')+'</p>';
    html += '<div class="year-end-metrics">';
    html += '<div class="year-metric"><div class="year-metric-lbl">æœ¬å¹´æ”¶å…¥</div><div class="year-metric-val">'+r+'ä¸‡</div></div>';
    html += '<div class="year-metric"><div class="year-metric-lbl">æœ¬å¹´ç”¨æˆ·</div><div class="year-metric-val">'+u+'ä¸‡</div></div>';
    html += '<div class="year-metric"><div class="year-metric-lbl">ç´¯è®¡æ”¶å…¥</div><div class="year-metric-val">'+g.totalRev+'ä¸‡</div></div>';
    html += '<div class="year-metric"><div class="year-metric-lbl">ç´¯è®¡ç”¨æˆ·</div><div class="year-metric-val">'+g.totalUsers+'ä¸‡</div></div>';
    html += '</div>';
    html += '<button class="btn btn-primary" id="nextYearBtn">å¼€å§‹ç¬¬'+(g.year+1)+'å¹´(ç»§ç»­å·)</button>';
    html += '</div>';
    document.getElementById('mainContent').innerHTML = html;
    
    document.getElementById('nextYearBtn').addEventListener('click', nextYear);
}

function nextYear() {
    g.year++;
    g.q = 1;
    g.actIdx = 0;
    g.phase = 'naming';
    
    // é‡ç½®æ•°å€¼,ä½†ä¿æŒä¸Šé™
    g.morale = 80;
    g.trust = 80;
    g.cash = 80;
    g.hair = 80;
    g.hype = 50;
    g.innovation = 50;
    g.playability = 50;
    g.monetization = 50;
    
    g.currentNaming = '';
    g.inOperation = false;
    g.opIdx = 0;
    g.survivalWarned = false;
    updateUI();
    showNaming();
}

function applyEff(eff) {
    for(var k in eff) {
        var v = eff[k];
        if(typeof v === 'function') v = v();
        
        // åº”ç”¨æ•ˆæœå€æ•°
        v = Math.round(v * g.effectMultiplier);
        
        if(k === 'morale' || k === 'trust' || k === 'cash' || k === 'hair') {
            // å›¢é˜Ÿæ•°å€¼
            if(g[k] !== undefined) {
                g[k] = Math.max(0, Math.min(g.teamMax, g[k] + v));
            }
        } else if(k === 'hype' || k === 'innovation' || k === 'playability' || k === 'monetization') {
            // äº§å“æ•°å€¼
            if(g[k] !== undefined) {
                g[k] = Math.max(0, Math.min(g.productMax, g[k] + v));
            }
        }
    }
    checkSurv();
}

function checkSurv() {
    var stats = {'å£«æ°”':g.morale,'ä¿¡ä»»':g.trust,'ç°é‡‘':g.cash,'å‘é‡':g.hair};
    var dangerStats = [];
    
    // æ£€æŸ¥å±é™©æ•°å€¼
    for(var s in stats) {
        if(stats[s] <= 20 && stats[s] > 0) {
            dangerStats.push(s + ':' + stats[s]);
        }
        if(stats[s] <= 0) {
            g.over = true;
            var msg = 'ğŸ’€ '+s+'å½’é›¶!\n\n';
            msg += 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n';
            msg += 'æ¸¸æˆç»“æŸ - é¡¹ç›®è¢«ç ,ä½ è¢«å¼€é™¤!\n';
            msg += 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n';
            msg += 'ğŸ“Š æœ€ç»ˆæˆç»©:\n';
            msg += 'â€¢ ç´¯è®¡æ”¶å…¥: '+g.totalRev+'ä¸‡\n';
            msg += 'â€¢ ç´¯è®¡ç”¨æˆ·: '+g.totalUsers+'ä¸‡\n';
            msg += 'â€¢ å­˜æ´»æ—¶é—´: ç¬¬'+g.year+'å¹´ Q'+g.q+'\n';
            msg += 'â€¢ æˆåŠŸäº§å“: '+g.successfulProducts+'æ¬¾\n\n';
            msg += 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n';
            msg += 'ğŸ’¡ æç¤º:\n';
            msg += 'ä½¿ç”¨ã€âš¡ç»­å‘½æœºåˆ¶ã€‘å¯ä»¥åœ¨å±æ€¥æ—¶åˆ»\n';
            msg += 'äº’æ¢æ•°å€¼æ•‘æ€¥!ç‚¹å‡»å†³ç­–ç•Œé¢çš„\n';
            msg += 'çº¢è‰²ç»­å‘½æŒ‰é’®å³å¯ä½¿ç”¨ã€‚\n';
            msg += 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n';
            msg += '3ç§’åè‡ªåŠ¨é‡æ–°å¼€å§‹...';
            alert(msg);
            
            setTimeout(function() {
                location.reload();
            }, 3000);
            return;
        }
    }
    
    // å¦‚æœæœ‰å±é™©æ•°å€¼,å¼¹å‡ºæç¤º
    if(dangerStats.length > 0 && !g.survivalWarned) {
        g.survivalWarned = true;
        setTimeout(function() {
            var warnMsg = 'âš ï¸ å±é™©è­¦å‘Š!\n\n';
            warnMsg += dangerStats.join(', ') + '\n\n';
            warnMsg += 'æ•°å€¼å³å°†å½’é›¶!\n';
            warnMsg += 'å»ºè®®ç«‹å³ä½¿ç”¨ã€âš¡ç»­å‘½æœºåˆ¶ã€‘\n';
            warnMsg += 'äº’æ¢æ•°å€¼æ•‘æ€¥!';
            alert(warnMsg);
            g.survivalWarned = false;
        }, 500);
    }
}

function updateUI() {
    var lvl = LEVELS[g.level];
    document.getElementById('careerLevel').textContent = g.level;
    document.getElementById('careerTitle').textContent = lvl.title;
    document.getElementById('quarter').textContent = 'Q' + g.q;
    document.getElementById('year').textContent = g.year;
    document.getElementById('miniRev').textContent = g.totalRev;
    document.getElementById('miniUsers').textContent = g.totalUsers;
    
    var liveCount = g.products.filter(function(p) { return p.status === 'live'; }).length;
    document.getElementById('miniProducts').textContent = liveCount;
    
    var qInc = g.products.filter(function(p) { return p.status === 'live'; }).reduce(function(s,p) { return s + p.curR; }, 0);
    document.getElementById('miniQRev').textContent = qInc;
}

function showProducts() {
    var html = '';
    if(g.cur && g.cur.status === 'dev') {
        html += '<div class="product-card" style="border-color:#16a34a;border-style:dashed;">';
        html += '<div class="product-header"><div class="product-name">'+g.cur.name+'</div><div class="product-status" style="background:rgba(37,99,235,0.1);color:#2563eb;">å¼€å‘ä¸­Q'+g.q+'</div></div>';
        html += '<div style="font-size:0.8rem;color:#64748b;margin-top:0.3rem;">æ­£åœ¨è‚...</div>';
        html += '</div>';
    }
    
    g.products.forEach(function(p) {
        var statusClass = p.status === 'live' ? 'status-live' : '';
        var statusText = p.status === 'live' ? 'è¿è¥ä¸­' : 'å·²åœè¿';
        html += '<div class="product-card">';
        html += '<div class="product-header"><div><div class="product-name">'+p.name+'</div><div style="font-size:0.75rem;color:#64748b;margin-top:0.2rem;">'+p.type+'</div></div><div class="product-status '+statusClass+'">'+statusText+'</div></div>';
        html += '<div style="font-size:0.8rem;color:#64748b;margin-top:0.5rem;">ç”¨æˆ·:'+p.curU+'ä¸‡ | æœˆæµæ°´:'+p.curR+'ä¸‡ | å‰©ä½™ç”Ÿå‘½:'+p.life+'%</div>';
        html += '</div>';
    });
    
    if(!html) {
        html = '<div class="card"><p style="text-align:center;color:#64748b;">è¿˜æ²¡æœ‰äº§å“,å¿«å»åšä¸€ä¸ªå§!</p></div>';
    }
    
    document.getElementById('mainContent').innerHTML = html;
}

// æ ¼å¼åŒ–æ•ˆæœ - åˆ†è¡Œæ˜¾ç¤ºæ­£è´Ÿ
function fmtEffSeparate(eff) {
    var lbl = {morale:'å£«æ°”',trust:'ä¿¡ä»»',cash:'ç°é‡‘',hair:'å‘é‡',hype:'æœŸå¾…',innovation:'åˆ›æ–°',playability:'å¯ç©æ€§',monetization:'å•†ä¸šåŒ–'};
    var positive = '';
    var negative = '';
    
    for(var k in eff) {
        if(typeof eff[k] === 'function') continue;
        var v = Math.round(eff[k] * g.effectMultiplier);
        if(v > 0) {
            positive += '<span class="effect-tag effect-positive">'+(lbl[k]||k)+' +'+v+'</span>';
        } else if(v < 0) {
            negative += '<span class="effect-tag effect-negative">'+(lbl[k]||k)+' '+v+'</span>';
        }
    }
    
    var html = '';
    if(positive) {
        html += '<div class="effects-row"><span class="effects-label" style="color:#16a34a;">âœ“ åŠ åˆ†:</span>'+positive+'</div>';
    }
    if(negative) {
        html += '<div class="effects-row"><span class="effects-label" style="color:#dc2626;">âœ— å‡åˆ†:</span>'+negative+'</div>';
    }
    
    return html || '<span style="color:#64748b;font-size:0.75rem;">æ— å½±å“</span>';
}

function fmtOpEff(eff) {
    var html = '';
    if(eff.userChange) html += '<span class="effect-tag '+(eff.userChange>0?'effect-positive':'effect-negative')+'">ç”¨æˆ· '+(eff.userChange>0?'+':'')+eff.userChange+'ä¸‡</span>';
    if(eff.revenueMultiplier) html += '<span class="effect-tag '+(eff.revenueMultiplier>1?'effect-positive':'effect-negative')+'">æµæ°´ Ã—'+eff.revenueMultiplier+'</span>';
    if(eff.lifecycleChange) html += '<span class="effect-tag '+(eff.lifecycleChange>0?'effect-positive':'effect-negative')+'">ç”Ÿå‘½ '+(eff.lifecycleChange>0?'+':'')+eff.lifecycleChange+'%</span>';
    if(eff.cost) html += '<span class="effect-tag effect-negative">æˆæœ¬ -'+eff.cost+'ä¸‡</span>';
    return html;
}
</script>
</body>
</html>
